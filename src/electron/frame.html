<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>PROCESS WARP</title>
  </head>
  <script>
    const electron = require('electron');
    const ipc      = electron.ipcRenderer;
    var global     = {};

    /**
     * When receive script, execute script.
     * @param event {object} Event instance from ipc.
     * @param script {string} Script string.
     */
    function recvScript(event, script) {
      console.log(script);
      eval(script);
    }
    ipc.on('script', recvScript);

    /**
     * When loading html was finished, send frame_load command to main thread.
     * @return {void}
     */
    function sendFrameLoad() {
      ipc.send('frame_load');
    }

    /**
     * When html has load, call all initialize methods.
     * @return {void}
     */
    function initialize() {
      sendFrameLoad();
      initializeCanvas();
      initializeOnResize();
    }
    
    /**
     * Get canvas, context and store instance to global object.
     * @return {void}
     */
    function initializeCanvas() {
      global.canvas_fore  = document.getElementById('canvas_fore');
      global.context_fore = global.canvas_fore.getContext('2d');

      global.canvas  = document.getElementById('canvas_back');
      global.context = global.canvas.getContext('2d');
    }

    /**
     * Add event when window size has changed, resize canvas size to fit.
     * @return {void}
     */
    function initializeOnResize() {
      var on_resize = function() {
        global.canvas_fore.width  = document.body.clientWidth;
        global.canvas_fore.height = document.body.clientHeight;

        global.canvas.width  = document.body.clientWidth;
        global.canvas.height = document.body.clientHeight;      
      }
      
      // Set first resize method.
      global.resize_timer = setTimeout(on_resize, 100);

      // When resize event was happen, update timeout.
      window.addEventListener('resize', function(event) {
        clearTimeout(global.resize_timer);

        global.resize_timer = setTimeout(on_resize, 100);
      });
    }
  </script>
  <style>
    html {
      height: 100%;
      overflow: hidden;
      width: 100%;
    }
    body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      width: 100%;
    }
    #canvas_fore {
      height: 100%;
      width: 100%;
      position: absolute;
      visibility: visible;
    }
    #canvas_back {
      height: 100%;
      width: 100%;
      position: absolute;
      visibility: hidden;
    }
  </style>
  <body id="body" onLoad="initialize();">
    <canvas id="canvas_fore"></canvas>
    <canvas id="canvas_back"></canvas>
  </body>
</html>
